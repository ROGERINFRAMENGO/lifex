<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Life Organizer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-light: #4f46e5;
            --primary-dark: #6366f1;
            --text-light: #1f2937;
            --text-dark: #f9fafb;
            --bg-light: #f9fafb;
            --bg-dark: #1e293b;
            --card-light: rgba(255, 255, 255, 0.8);
            --card-dark: rgba(30, 41, 59, 0.8);
        }

        body {
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
            min-height: 100vh;
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }

        .day-theme {
            background-image: url('https://placehold.co/1920x1080?text=Day+Theme%3A+Bright+sunny+sky+with+white+clouds');
            color: var(--text-light);
            background-color: var(--bg-light);
        }

        .night-theme {
            background-image: url('https://placehold.co/1920x1080?text=Night+Theme%3A+Dark+blue+sky+with+stars+and+moon');
            color: var(--text-dark);
            background-color: var(--bg-dark);
        }

        .card {
            backdrop-filter: blur(10px);
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: transform 0.2s ease;
        }

        .card:hover {
            transform: translateY(-2px);
        }

        .board-column {
            min-height: 400px;
        }

        .task-card {
            cursor: grab;
        }

        .task-card:active {
            cursor: grabbing;
        }

        .dragging {
            opacity: 0.5;
        }

        /* Estilos para edi√ß√£o */
        .category-pill {
            cursor: pointer;
            transition: all 0.2s;
        }

        .date-display {
            cursor: pointer;
        }

        .color-picker {
            display: none;
            position: absolute;
            z-index: 100;
            background: white;
            padding: 0.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .color-option {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: inline-block;
            margin: 0.1rem;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .color-option:hover {
            border-color: #000;
        }

        .color-option.selected {
            border-color: #000;
            transform: scale(1.1);
        }

        /* Estilos para o tempo */
        .weather-icon {
            width: 40px;
            height: 40px;
            font-size: 40px;
            line-height: 40px;
            text-align: center;
        }

        .weather-icon-small {
            width: 24px;
            height: 24px;
            font-size: 24px;
            line-height: 24px;
            text-align: center;
        }

        /* Estilos para login */
        .login-container {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }

        .shake {
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
    </style>
</head>
<body class="day-theme">
    <!-- Tela de Login -->
    <div id="login-screen" class="flex items-center justify-center p-4 fixed inset-0 z-50">
        <div class="login-container p-8 rounded-2xl shadow-2xl w-full max-w-md">
            <div class="text-center mb-8">
                <img src="https://placehold.co/100x100?text=LOGO" alt="Logo Life Organizer" class="mx-auto mb-4 rounded-lg">
                <h1 class="text-3xl font-bold text-gray-800">Life Organizer</h1>
                <p class="text-gray-600">Acesso pessoal</p>
            </div>
            
            <form id="login-form" class="space-y-6">
                <div>
                    <label for="password" class="block text-sm font-medium text-gray-700 mb-1">Senha de Acesso</label>
                    <div class="relative">
                        <input 
                            type="password" 
                            id="password" 
                            class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition"
                            placeholder="Digite sua senha"
                            autocomplete="current-password"
                            required
                        >
                    </div>
                </div>
                
                <button 
                    type="submit" 
                    class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-3 px-4 rounded-lg transition flex items-center justify-center"
                >
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd" />
                    </svg>
                    Acessar
                </button>
                
                <div id="error-message" class="text-red-500 text-sm text-center hidden">
                    Senha incorreta. Tente novamente.
                </div>
            </form>
        </div>
    </div>

    <!-- Conte√∫do Principal (inicialmente oculto) -->
    <div id="app-content" class="hidden container mx-auto px-4 py-8 max-w-7xl">
        <!-- Header -->
        <header class="flex flex-col md:flex-row justify-between items-center mb-8 glass p-6 rounded-xl">
            <div class="text-center md:text-left mb-4 md:mb-0">
                <h1 class="text-3xl font-bold">Life Organizer</h1>
                <p class="text-lg">Sua plataforma de organiza√ß√£o pessoal</p>
            </div>
            
            <div class="flex flex-col sm:flex-row gap-4 items-center">
                <div class="flex items-center gap-2 bg-white/30 dark:bg-black/30 p-3 rounded-lg">
                    <div id="clock" class="text-xl font-semibold">00:00:00</div>
                    <div id="date" class="text-sm">Brasil</div>
                </div>
                
                <div class="flex items-center gap-2 bg-white/30 dark:bg-black/30 p-3 rounded-lg">
                    <span id="weather-icon" class="weather-icon">‚è≥</span>
                    <div>
                        <div id="temperature" class="font-semibold">--¬∞C</div>
                        <div id="weather-desc" class="text-xs">S√£o Paulo</div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="grid grid-cols-1 lg:grid-cols-4 gap-6">
            <!-- Tasks Board -->
            <div class="lg:col-span-3 grid grid-cols-1 md:grid-cols-3 gap-4">
                <!-- Column 1: Metas -->
                <div class="board-column bg-white/50 dark:bg-gray-800/50 p-4 rounded-xl">
                    <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">
                        <span class="p-2 rounded-lg bg-indigo-100 dark:bg-indigo-900 text-indigo-600 dark:text-indigo-300">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                            </svg>
                        </span>
                        Metas
                    </h2>
                    <div class="space-y-3" id="goals-column">
                        <!-- Cards ser√£o adicionados aqui -->
                    </div>
                    <button onclick="addNewCard('goals-column')" class="mt-3 w-full py-2 text-center text-sm text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition">
                        + Adicionar meta
                    </button>
                </div>
                
                <!-- Column 2: Datas Importantes -->
                <div class="board-column bg-white/50 dark:bg-gray-800/50 p-4 rounded-xl">
                    <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">
                        <span class="p-2 rounded-lg bg-green-100 dark:bg-green-900 text-green-600 dark:text-green-300">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                <line x1="16" y1="2" x2="16" y2="6"></line>
                                <line x1="8" y1="2" x2="8" y2="6"></line>
                                <line x1="3" y1="10" x2="21" y2="10"></line>
                            </svg>
                        </span>
                        Datas
                    </h2>
                    <div class="space-y-3" id="dates-column">
                        <!-- Cards ser√£o adicionados aqui -->
                    </div>
                    <button onclick="addNewCard('dates-column')" class="mt-3 w-full py-2 text-center text-sm text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition">
                        + Adicionar data
                    </button>
                </div>
                
                <!-- Column 3: Finan√ßas -->
                <div class="board-column bg-white/50 dark:bg-gray-800/50 p-4 rounded-xl">
                    <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">
                        <span class="p-2 rounded-lg bg-purple-100 dark:bg-purple-900 text-purple-600 dark:text-purple-300">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="12" y1="1" x2="12" y2="23"></line>
                                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                            </svg>
                        </span>
                        Finan√ßas
                    </h2>
                    <div class="space-y-3" id="finance-column">
                        <!-- Cards ser√£o adicionados aqui -->
                    </div>
                    <button onclick="addNewCard('finance-column')" class="mt-3 w-full py-2 text-center text-sm text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition">
                        + Adicionar financiamento
                    </button>
                </div>
            </div>
            
            <!-- Sidebar -->
            <div class="space-y-6">
                <!-- Weekly Weather -->
                <div class="bg-white/50 dark:bg-gray-800/50 p-4 rounded-xl">
                    <h2 class="text-xl font-semibold mb-4">Previs√£o Semanal</h2>
                    <div class="space-y-3" id="weekly-weather">
                        <!-- Previs√£o ser√° carregada aqui -->
                    </div>
                </div>
                
                <!-- Quick Notes -->
                <div class="bg-white/50 dark:bg-gray-800/50 p-4 rounded-xl">
                    <h2 class="text-xl font-semibold mb-4">Anota√ß√µes R√°pidas</h2>
                    <textarea id="quick-notes" class="w-full p-3 bg-white/80 dark:bg-gray-700/80 rounded-lg border border-gray-200 dark:border-gray-600 focus:border-indigo-500 focus:ring-indigo-500" rows="5" placeholder="Escreva suas anota√ß√µes aqui..."></textarea>
                    <button onclick="saveNotes()" class="mt-2 w-full bg-indigo-600 hover:bg-indigo-700 text-white py-2 px-4 rounded-lg transition">
                        Salvar
                    </button>
                </div>
                
                <!-- Progress -->
                <div class="bg-white/50 dark:bg-gray-800/50 p-4 rounded-xl">
                    <h2 class="text-xl font-semibold mb-4">Seu Progresso</h2>
                    <div class="space-y-3">
                        <div>
                            <div class="flex justify-between text-sm mb-1">
                                <span>Metas</span>
                                <span id="goals-progress">0%</span>
                            </div>
                            <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                                <div id="goals-progress-bar" class="bg-indigo-600 h-2 rounded-full" style="width: 0%"></div>
                            </div>
                        </div>
                        
                        <div>
                            <div class="flex justify-between text-sm mb-1">
                                <span>Finan√ßas</span>
                                <span id="finance-progress">0%</span>
                            </div>
                            <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                                <div id="finance-progress-bar" class="bg-green-600 h-2 rounded-full" style="width: 0%"></div>
                            </div>
                        </div>
                        
                        <div>
                            <div class="flex justify-between text-sm mb-1">
                                <span>Sa√∫de</span>
                                <span id="health-progress">0%</span>
                            </div>
                            <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                                <div id="health-progress-bar" class="bg-blue-600 h-2 rounded-full" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // ========== CONFIGURA√á√ïES GERAIS ==========
        // Hash SHA-256 da senha "anaflavia1723"
        const CORRECT_HASH = '108c7ac2b5a18030b48b8a55722d2c9c4380516d671f59307916fd6d2571b69a';
        
        // Categorias pr√©-definidas com cores
        const CATEGORIES = [
            { name: "Trabalho", color: "bg-indigo-100", text: "text-indigo-600" },
            { name: "Pessoal", color: "bg-green-100", text: "text-green-600" },
            { name: "Sa√∫de", color: "bg-blue-100", text: "text-blue-600" },
            { name: "Finan√ßas", color: "bg-purple-100", text: "text-purple-600" },
            { name: "Estudos", color: "bg-yellow-100", text: "text-yellow-600" },
            { name: "Lazer", color: "bg-pink-100", text: "text-pink-600" }
        ];

        // Cores dispon√≠veis para os cards
        const CARD_COLORS = [
            'bg-white', 'bg-red-50', 'bg-blue-50', 'bg-green-50', 
            'bg-yellow-50', 'bg-purple-50', 'bg-pink-50', 'bg-indigo-50'
        ];

        // Mapeamento de c√≥digos clim√°ticos para emojis
        const WEATHER_ICONS = {
            0: '‚òÄÔ∏è', 1: 'üå§Ô∏è', 2: '‚õÖ', 3: '‚òÅÔ∏è', 45: 'üå´Ô∏è', 48: 'üå´Ô∏è',
            51: 'üåßÔ∏è', 53: 'üåßÔ∏è', 55: 'üåßÔ∏è', 56: 'üåßÔ∏è', 57: 'üåßÔ∏è',
            61: 'üåßÔ∏è', 63: 'üåßÔ∏è', 65: 'üåßÔ∏è', 66: 'üåßÔ∏è', 67: 'üåßÔ∏è',
            71: '‚ùÑÔ∏è', 73: '‚ùÑÔ∏è', 75: '‚ùÑÔ∏è', 77: '‚ùÑÔ∏è', 80: 'üå¶Ô∏è',
            81: 'üå¶Ô∏è', 82: 'üå¶Ô∏è', 85: '‚ùÑÔ∏è', 86: '‚ùÑÔ∏è', 95: '‚õàÔ∏è',
            96: '‚õàÔ∏è', 99: '‚õàÔ∏è'
        };

        // ========== FUN√á√ïES DE INICIALIZA√á√ÉO ==========
        document.addEventListener('DOMContentLoaded', () => {
            setupLogin();
            checkAuthentication();
            loadInitialData();
        });

        // ========== SISTEMA DE LOGIN ==========
        function setupLogin() {
            const loginForm = document.getElementById('login-form');
            const passwordInput = document.getElementById('password');
            const errorMessage = document.getElementById('error-message');
            const loginScreen = document.getElementById('login-screen');
            
            loginForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const password = passwordInput.value;
                const hashedPassword = await sha256(password);
                
                if (hashedPassword === CORRECT_HASH) {
                    // Login bem-sucedido
                    localStorage.setItem('authenticated', 'true');
                    loginScreen.classList.add('hidden');
                    document.getElementById('app-content').classList.remove('hidden');
                    initializeApp();
                } else {
                    // Login falhou
                    passwordInput.value = '';
                    loginForm.classList.add('shake');
                    errorMessage.classList.remove('hidden');
                    
                    setTimeout(() => {
                        loginForm.classList.remove('shake');
                    }, 500);
                }
            });
        }

        function checkAuthentication() {
            if (localStorage.getItem('authenticated') === 'true') {
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('app-content').classList.remove('hidden');
                initializeApp();
            }
        }

        async function sha256(message) {
            const msgBuffer = new TextEncoder().encode(message);
            const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        }

        // ========== FUN√á√ïES PRINCIPAIS DO APP ==========
        function initializeApp() {
            updateTheme();
            updateClock();
            updateWeatherUI();
            initializeDragAndDrop();
            initializeEditableElements();
            loadNotes();
            
            // Configurar intervalos
            setInterval(updateClock, 1000);
            setInterval(updateTheme, 60000);
            setInterval(updateWeatherUI, 3600000);
        }

        // ========== TEMA E REL√ìGIO ==========
        function updateTheme() {
            const now = new Date();
            const hour = now.getHours();
            const body = document.body;
            
            if (hour >= 18 || hour < 6) {
                body.classList.remove('day-theme');
                body.classList.add('night-theme');
                document.documentElement.classList.add('dark');
            } else {
                body.classList.remove('night-theme');
                body.classList.add('day-theme');
                document.documentElement.classList.remove('dark');
            }
        }

        function updateClock() {
            const now = new Date();
            const options = { 
                timeZone: 'America/Sao_Paulo',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: false
            };
            
            const dateOptions = {
                timeZone: 'America/Sao_Paulo',
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            };
            
            document.getElementById('clock').textContent = now.toLocaleTimeString('pt-BR', options);
            document.getElementById('date').textContent = now.toLocaleDateString('pt-BR', dateOptions);
        }

        // ========== PREVIS√ÉO DO TEMPO ==========
        async function fetchWeatherData() {
            try {
                const response = await fetch('https://api.open-meteo.com/v1/forecast?latitude=-23.5475&longitude=-46.6361&current=temperature_2m,weather_code&hourly=temperature_2m,weather_code&daily=weather_code,temperature_2m_max,temperature_2m_min&timezone=America/Sao_Paulo');
                
                if (!response.ok) throw new Error('Erro ao buscar dados meteorol√≥gicos');
                return await response.json();
            } catch (error) {
                console.error('Erro na API de clima:', error);
                return null;
            }
        }

        function getWeatherEmoji(weatherCode) {
            return WEATHER_ICONS[weatherCode] || 'üåà';
        }

        function getWeatherDescription(weatherCode) {
            const descriptions = {
                0: 'C√©u limpo', 1: 'Principalmente limpo', 2: 'Parcialmente nublado', 
                3: 'Nublado', 45: 'Nevoeiro', 48: 'Nevoeiro com geada',
                51: 'Chuvisco leve', 53: 'Chuvisco moderado', 55: 'Chuvisco denso',
                56: 'Chuvisco congelante leve', 57: 'Chuvisco congelante denso',
                61: 'Chuva leve', 63: 'Chuva moderada', 65: 'Chuva forte',
                66: 'Chuva congelante leve', 67: 'Chuva congelante forte',
                71: 'Neve leve', 73: 'Neve moderada', 75: 'Neve forte',
                77: 'Gr√£os de neve', 80: 'Aguaceiros leves',
                81: 'Aguaceiros moderados', 82: 'Aguaceiros violentos',
                85: 'Neve leve em aguaceiros', 86: 'Neve forte em aguaceiros',
                95: 'Trovoada leve ou moderada', 96: 'Trovoada com granizo leve',
                99: 'Trovoada com granizo forte'
            };
            return descriptions[weatherCode] || 'Condi√ß√£o desconhecida';
        }

        async function updateWeatherUI() {
            const weatherData = await fetchWeatherData();
            
            if (!weatherData) {
                updateWeatherFallback();
                return;
            }
            
            // Atualizar dados atuais
            const current = weatherData.current;
            document.getElementById('temperature').textContent = `${Math.round(current.temperature_2m)}¬∞C`;
            document.getElementById('weather-desc').textContent = getWeatherDescription(current.weather_code);
            document.getElementById('weather-icon').textContent = getWeatherEmoji(current.weather_code);
            
            // Atualizar previs√£o di√°ria
            const dailyContainer = document.getElementById('weekly-weather');
            dailyContainer.innerHTML = '';
            
            for (let i = 0; i < 5; i++) {
                const dayName = i === 0 ? 'Hoje' : new Date(new Date().setDate(new Date().getDate() + i)).toLocaleDateString('pt-BR', { weekday: 'short' });
                const maxTemp = weatherData.daily.temperature_2m_max[i];
                const weatherCode = weatherData.daily.weather_code[i];
                
                const dayElement = document.createElement('div');
                dayElement.className = 'flex justify-between items-center';
                dayElement.innerHTML = `
                    <span class="text-sm font-medium">${dayName}</span>
                    <div class="flex items-center gap-2">
                        <span class="font-medium">${Math.round(maxTemp)}¬∞C</span>
                        <span class="weather-icon-small">${getWeatherEmoji(weatherCode)}</span>
                    </div>
                `;
                dailyContainer.appendChild(dayElement);
            }
        }

        function updateWeatherFallback() {
            const forecastData = [
                { day: 'Hoje', temp: 25, icon: '‚õÖ' },
                { day: 'Amanh√£', temp: 24, icon: 'üåßÔ∏è' },
                { day: 'Ter√ßa', temp: 26, icon: '‚õÖ' },
                { day: 'Quarta', temp: 28, icon: '‚òÄÔ∏è' },
                { day: 'Quinta', temp: 23, icon: 'üåßÔ∏è' }
            ];
            
            const container = document.getElementById('weekly-weather');
            container.innerHTML = '';
            
            forecastData.forEach(day => {
                const dayElement = document.createElement('div');
                dayElement.className = 'flex justify-between items-center';
                dayElement.innerHTML = `
                    <span class="text-sm font-medium">${day.day}</span>
                    <div class="flex items-center gap-2">
                        <span class="font-medium">${day.temp}¬∞C</span>
                        <span class="weather-icon-small">${day.icon}</span>
                    </div>
                `;
                container.appendChild(dayElement);
            });
        }

        // ========== DRAG AND DROP ==========
        function initializeDragAndDrop() {
            const draggables = document.querySelectorAll('.draggable');
            const containers = document.querySelectorAll('.board-column > div');

            draggables.forEach(draggable => {
                draggable.addEventListener('dragstart', () => {
                    draggable.classList.add('dragging');
                });

                draggable.addEventListener('dragend', () => {
                    draggable.classList.remove('dragging');
                });
            });

            containers.forEach(container => {
                container.addEventListener('dragover', e => {
                    e.preventDefault();
                    const afterElement = getDragAfterElement(container, e.clientY);
                    const draggable = document.querySelector('.dragging');
                    
                    if (!afterElement) {
                        container.appendChild(draggable);
                    } else {
                        container.insertBefore(draggable, afterElement);
                    }
                });
            });

            function getDragAfterElement(container, y) {
                const draggableElements = [...container.querySelectorAll('.draggable:not(.dragging)')];
                
                return draggableElements.reduce((closest, child) => {
                    const box = child.getBoundingClientRect();
                    const offset = y - box.top - box.height / 2;
                    
                    if (offset < 0 && offset > closest.offset) {
                        return { offset: offset, element: child };
                    } else {
                        return closest;
                    }
                }, { offset: Number.NEGATIVE_INFINITY }).element;
            }
        }

        // ========== EDITAR ELEMENTOS ==========
        function initializeEditableElements() {
            // Editar t√≠tulo e descri√ß√£o
            document.addEventListener('click', (e) => {
                if (e.target.matches('.task-card h3, .task-card p')) {
                    e.target.contentEditable = true;
                    e.target.focus();
                }
            });

            document.addEventListener('blur', (e) => {
                if (e.target.matches('.task-card h3, .task-card p')) {
                    e.target.contentEditable = false;
                }
            }, true);

            // Editar categoria
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('category-pill')) {
                    e.stopPropagation();
                    const currentCategory = e.target.textContent.trim();
                    
                    createCategorySelector(currentCategory, (newCat) => {
                        e.target.className = `category-pill text-xs px-2 py-1 rounded ${newCat.color} ${newCat.text}`;
                        e.target.textContent = newCat.name;
                    });
                }
            });

            // Editar data
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('date-display')) {
                    e.stopPropagation();
                    
                    createDatePicker(e.target, (newDate) => {
                        e.target.textContent = newDate;
                    });
                }
            });

            // Editar cor do card (bot√£o direito)
            document.addEventListener('contextmenu', (e) => {
                if (e.target.closest('.task-card')) {
                    e.preventDefault();
                    const card = e.target.closest('.task-card');
                    const currentColor = CARD_COLORS.find(color => card.classList.contains(color)) || 'bg-white';
                    
                    createCardColorSelector(currentColor, (newColor) => {
                        CARD_COLORS.forEach(color => card.classList.remove(color));
                        card.classList.add(newColor);
                    }, e.clientX, e.clientY);
                }
            });
        }

        function createCategorySelector(currentCategory, callback) {
            const selector = document.createElement('div');
            selector.className = 'color-picker p-2 rounded-lg shadow-lg';
            selector.style.position = 'absolute';
            selector.style.zIndex = '100';
            selector.style.left = '0';
            selector.style.top = '100%';
            selector.style.backgroundColor = 'white';

            CATEGORIES.forEach(cat => {
                const option = document.createElement('div');
                option.className = `px-3 py-1 rounded-full mb-1 cursor-pointer hover:bg-gray-100 flex items-center ${cat.name === currentCategory ? 'bg-gray-100' : ''}`;
                option.innerHTML = `
                    <span class="w-4 h-4 rounded-full ${cat.color.replace('bg-', 'bg-')} mr-2"></span>
                    ${cat.name}
                `;
                option.addEventListener('click', () => {
                    callback(cat);
                    document.body.removeChild(selector);
                });
                selector.appendChild(option);
            });

            document.body.appendChild(selector);
            return selector;
        }

        function createDatePicker(element, callback) {
            const picker = document.createElement('input');
            picker.type = 'date';
            picker.style.position = 'absolute';
            picker.style.zIndex = '100';
            picker.style.left = '0';
            picker.style.top = '100%';
            
            // Formatar data existente
            const currentDate = element.textContent.trim();
            if (currentDate.match(/\d{2}\/\d{2}\/\d{4}/)) {
                const [day, month, year] = currentDate.split('/');
                picker.value = `${year}-${month}-${day}`;
            }

            picker.addEventListener('change', (e) => {
                const date = new Date(e.target.value);
                callback(date.toLocaleDateString('pt-BR'));
                document.body.removeChild(picker);
            });

            picker.addEventListener('blur', () => {
                document.body.removeChild(picker);
            });

            document.body.appendChild(picker);
            picker.focus();
            return picker;
        }

        function createCardColorSelector(currentColor, callback, posX, posY) {
            const selector = document.createElement('div');
            selector.className = 'color-picker p-2 rounded-lg shadow-lg';
            selector.style.position = 'fixed';
            selector.style.zIndex = '100';
            selector.style.left = `${posX}px`;
            selector.style.top = `${posY}px`;
            selector.style.backgroundColor = 'white';

            CARD_COLORS.forEach(color => {
                const option = document.createElement('div');
                option.className = `color-option ${color} ${color === currentColor ? 'selected' : ''}`;
                option.addEventListener('click', () => {
                    callback(color);
                    document.body.removeChild(selector);
                });
                selector.appendChild(option);
            });

            document.body.appendChild(selector);
            return selector;
        }

        // ========== GERENCIAMENTO DE CARDS ==========
        function addNewCard(columnId) {
            const container = document.getElementById(columnId);
            const newCard = createCardElement();
            container.prepend(newCard);
            initializeDragAndDrop();
            initializeEditableElements();
        }

        function createCardElement() {
            const card = document.createElement('div');
            card.className = 'task-card p-3 rounded-lg bg-white shadow-sm draggable';
            card.draggable = true;
            card.innerHTML = `
                <h3 class="font-medium" contenteditable="true">Novo Card</h3>
                <p class="text-sm text-gray-600 dark:text-gray-300" contenteditable="true">Descri√ß√£o</p>
                <div class="mt-2 flex justify-between items-center">
                    <span class="category-pill text-xs px-2 py-1 rounded bg-gray-100 text-gray-600">Sem Categoria</span>
                    <span class="date-display text-xs text-gray-500">${new Date().toLocaleDateString('pt-BR')}</span>
                </div>
            `;
            return card;
        }

        // ========== ANOTA√á√ïES R√ÅPIDAS ==========
        function saveNotes() {
            const notes = document.getElementById('quick-notes').value;
            localStorage.setItem('quick-notes', notes);
            showNotification('Anota√ß√µes salvas!');
        }

        function loadNotes() {
            const savedNotes = localStorage.getItem('quick-notes');
            if (savedNotes) {
                document.getElementById('quick-notes').value = savedNotes;
            }
        }

        // ========== CARREGAR DADOS INICIAIS ==========
        function loadInitialData() {
            // Adiciona alguns cards de exemplo
            const columns = {
                'goals-column': [
                    { title: 'Comprar apartamento', desc: 'Economizar R$ 200.000 at√© dez/2025', category: 0, date: '15/12/2025' },
                    { title: 'Aprender ingl√™s fluente', desc: 'Concluir curso avan√ßado', category: 4, date: '30/06/2024' }
                ],
                'dates-column': [
                    { title: 'Anivers√°rio da esposa', desc: 'Preparar surpresa', category: 5, date: '10/11/2023' },
                    { title: 'Consulta m√©dica', desc: 'Check-up anual', category: 2, date: '05/12/2023' }
                ],
                'finance-column': [
                    { title: 'Pagar faculdade', desc: 'Mensalidade curso MBA', category: 3, date: '05/12/2023' },
                    { title: 'Investir em ETFs', desc: 'R$ 500 por m√™s', category: 3, date: 'Todo m√™s' }
                ]
            };

            for (const [columnId, cards] of Object.entries(columns)) {
                const container = document.getElementById(columnId);
                cards.forEach(cardData => {
                    const card = createCardElement();
                    card.querySelector('h3').textContent = cardData.title;
                    card.querySelector('p').textContent = cardData.desc;
                    
                    const categoryInfo = CATEGORIES[cardData.category];
                    const categoryPill = card.querySelector('.category-pill');
                    categoryPill.className = `category-pill text-xs px-2 py-1 rounded ${categoryInfo.color} ${categoryInfo.text}`;
                    categoryPill.textContent = categoryInfo.name;
                    
                    card.querySelector('.date-display').textContent = cardData.date;
                    
                    container.appendChild(card);
                });
            }
        }

        // ========== UTILIT√ÅRIOS ==========
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'fixed bottom-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('opacity-0', 'translate-y-2', 'transition-all', 'duration-300');
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 2000);
        }
    </script>
</body>
</html>
